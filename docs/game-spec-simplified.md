# 在线翻牌猜卡游戏（简化版）

## 一、项目背景
这是一个双人在线翻牌游戏，灵感来自《猜猜我是谁》。目标是通过语音问答逐步排除不可能的卡片，最终猜出对方的底牌。当前版本只实现最小可运行功能（MVP），保证两名玩家能顺利进行一场游戏。

---

## 二、游戏规则
1. **进入方式**
   - 玩家以游客身份进入，仅需输入昵称。
   - 通过房间码进入同一房间。

2. **开局发牌**
   - 系统从牌库中随机抽取 **20 张不重复的图片**。
   - 两位玩家使用同一组卡片。
   - 每位玩家随机分配 1 张底牌，仅自己可见。

3. **语音互动**
   - 双方进入房间后始终可语音对话（后续可限制“提问回合才能说话”，当前默认自由对话）。

4. **翻牌与排除**
   - 玩家在自己界面上本地翻盖卡片排除候选。
   - 系统只同步**剩余卡片数量**，不同步具体哪几张被翻盖。

5. **猜测底牌**
   - 玩家可在任意时刻发起“猜测”。
   - 猜对立即获胜；猜错立即判负。

---

## 三、功能点（MVP）
- 游客昵称登录 + 房间码进入。
- 系统生成 20 张图片并分配各自底牌。
- 实时语音通话（WebRTC 为主；占位可用 WebSocket 传片段）。
- 玩家本地翻盖；向服务器同步**剩余牌数**。
- 发起猜测 → 服务器判定 → 广播胜负结果。

---

## 四、界面布局
1. **登录页**
   - 输入昵称 + 房间码；创建房间 / 加入房间。

2. **游戏界面**
   - 顶部：房间号、剩余卡数（自己 vs 对手）。
   - 中部：20 张卡片网格（可翻盖，本地置灰）。
   - 底部：左侧我的底牌；中间语音按钮；右侧猜测按钮。

3. **结算页**
   - 胜负结果 + 对方底牌展示 + 再来一局按钮（占位）。

---

## 五、WebSocket 事件设计（对局过程三类 + 初始化一次）

### 0) 初始化（一次性）
- **类型**：`init_state`
- **说明**：玩家加入房间后，向各自发送公共牌组与**自己的**底牌。
- **示例**：
```json
{
  "type": "init_state",
  "roomId": "AB12CD",
  "deck": ["img_01","img_02", "...", "img_20"],
  "mySecret": "img_07",
  "opponentRemaining": 20
}
```

### 1) 语音传输
- **类型**：`voice`
- **说明**：传递语音数据（推荐用 WebRTC；此事件可作为信令或占位）。
- **示例**：
```json
{
  "type": "voice",
  "from": "playerA",
  "data": "<binary audio chunk or SDP/ICE signal>"
}
```

### 2) 同步剩余牌数
- **类型**：`update_remaining`
- **说明**：玩家本地翻盖后，发送自己的剩余数量；服务器转发给对手。
- **示例**：
```json
{
  "type": "update_remaining",
  "from": "playerA",
  "remaining": 12
}
```

### 3) 猜测与结果
- **请求**：`guess`
- **响应**：`result`
- **说明**：发起猜测，服务器与对手底牌比对并广播结果。

- **示例（请求）**：
```json
{
  "type": "guess",
  "from": "playerA",
  "cardId": "img_05"
}
```

- **示例（响应）**：
```json
{
  "type": "result",
  "winner": "playerA",
  "correctCard": "img_05"
}
```

---

## 六、最小实现流程
- 进入房间 → 服务器生成 20 张卡 & 分配底牌 → 下发 `init_state` →
- 双方语音沟通 → 玩家本地翻盖 & 发送 `update_remaining` →
- 任一玩家 `guess` → 服务器判定并广播 `result` → 结算。
