<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Game Server Test</title>
    <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .controls { margin: 10px 0; }
        .controls input, button { margin: 5px; padding: 5px; }
        #output { border: 1px solid #ccc; padding: 10px; height: 300px; overflow-y: scroll; background: #f9f9f9; }
        .message { margin: 2px 0; padding: 2px; }
        .connected { color: green; }
        .error { color: red; }
        .game { color: blue; }
    </style>
</head>
<body>
    <h1>Socket.IO Game Server Test</h1>

    <div class="controls">
        <input id="nickname" placeholder="Enter nickname" value="Player1">
        <input id="roomId" placeholder="Enter room ID" value="room123">
        <button onclick="joinRoom()">Join Room</button>
        <button onclick="disconnect()">Disconnect</button>
    </div>

    <div class="controls">
        <button onclick="markReady()">Ready</button>
        <button onclick="updateRemaining(15)">Set Remaining: 15</button>
        <button onclick="updateRemaining(10)">Set Remaining: 10</button>
        <button onclick="makeGuess('card_1')">Guess: card_1</button>
        <button onclick="makeGuess('card_5')">Guess: card_5</button>
    </div>

    <div class="controls">
        <button onclick="clearOutput()">Clear Output</button>
    </div>

    <div id="output"></div>

    <script>
        let socket = null;
        const output = document.getElementById('output');

        function log(message, className = '') {
            const div = document.createElement('div');
            div.className = `message ${className}`;
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            output.appendChild(div);
            output.scrollTop = output.scrollHeight;
        }

        function connect() {
            socket = io('http://localhost:3001');

            socket.on('connect', () => {
                log('‚úÖ Connected to server', 'connected');
            });

            socket.on('disconnect', () => {
                log('‚ùå Disconnected from server', 'error');
            });

            socket.on('init_state', (data) => {
                log('üéÆ Game initialized: ' + JSON.stringify(data), 'game');
            });

            socket.on('update_remaining', (data) => {
                log('üìä Remaining updated: ' + JSON.stringify(data), 'game');
            });

            socket.on('result', (data) => {
                log('üèÜ Game result: ' + JSON.stringify(data), 'game');
            });

            socket.on('voice', (data) => {
                log('üé§ Voice data received: ' + JSON.stringify(data), 'game');
            });

            socket.on('player_joined', (data) => {
                log('üèÉ‚Äç‚ôÇÔ∏è Player joined: ' + JSON.stringify(data), 'game');
            });

            socket.on('player_ready', (data) => {
                log('‚úÖ Player ready: ' + JSON.stringify(data), 'game');
            });

            socket.on('game_started', (data) => {
                log('üéÆ Game started: ' + JSON.stringify(data), 'game');
            });

            socket.on('error', (data) => {
                log('‚ùå Error: ' + JSON.stringify(data), 'error');
            });

            socket.on('room_info', (data) => {
                log('üëì Current room info: ' + JSON.stringify(data), 'game');
            })
        }

        function joinRoom() {
            if (!socket) connect();

            const nickname = document.getElementById('nickname').value;
            const roomId = document.getElementById('roomId').value;

            if (!nickname || !roomId) {
                log('‚ùå Please enter nickname and room ID', 'error');
                return;
            }

            log(`üöÄ Joining room "${roomId}" as "${nickname}"`);
            socket.emit('join_room', { roomId, nickname });
        }

        function markReady() {
            if (!socket) {
                log('‚ùå Not connected to server', 'error');
                return;
            }

            const roomId = document.getElementById('roomId').value;
            if (!roomId) {
                log('‚ùå Please enter room ID first', 'error');
                return;
            }

            log(`‚úÖ Marking ready in room ${roomId}`);
            socket.emit('ready', { roomId });
        }

        function updateRemaining(count) {
            if (!socket) {
                log('‚ùå Not connected to server', 'error');
                return;
            }

            const roomId = document.getElementById('roomId').value;
            if (!roomId) {
                log('‚ùå Please enter room ID first', 'error');
                return;
            }

            log(`üìä Updating remaining cards to ${count}`);
            socket.emit('update_remaining', { roomId, remaining: count });
        }

        function makeGuess(cardId) {
            if (!socket) {
                log('‚ùå Not connected to server', 'error');
                return;
            }

            const roomId = document.getElementById('roomId').value;
            if (!roomId) {
                log('‚ùå Please enter room ID first', 'error');
                return;
            }

            log(`üéØ Making guess: ${cardId}`);
            socket.emit('guess', { roomId, cardId });
        }

        function disconnect() {
            if (socket) {
                socket.disconnect();
                socket = null;
                log('üîå Disconnected', 'error');
            }
        }

        function clearOutput() {
            output.innerHTML = '';
        }

        // Auto-connect on page load
        connect();

        log('üåê Test client loaded. Click "Join Room" to start testing!');
    </script>
</body>
</html>